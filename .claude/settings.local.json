{
  "permissions": {
    "allow": [
      "mcp__augment-context-engine__codebase-retrieval",
      "Bash(npx openspec:*)",
      "Bash(npx vue-tsc:*)",
      "Bash(test:*)",
      "Bash(openspec new:*)",
      "Bash(openspec status:*)",
      "Bash(openspec instructions proposal:*)",
      "Bash(openspec complete:*)",
      "Bash(openspec --help:*)",
      "Bash(openspec instructions design:*)",
      "Bash(openspec instructions:*)",
      "Bash(ls \"D:\\\\HoaThoDienBan\\\\VueJS\\\\project-datchi\\\\server\\\\types\"\" 2>nul || echo \"Directory does not exist \")",
      "Bash(\"D:\\\\HoaThoDienBan\\\\VueJS\\\\project-datchi\\\\src\\\\composables\\\\thread\\\\useWeeklyOrder.ts\" << 'ENDOFFILE'\n/**\n * Weekly Order Composable\n *\n * Provides reactive state and CRUD operations for weekly thread orders.\n */\n\nimport { ref, computed } from 'vue'\nimport { weeklyOrderService } from '@/services/weeklyOrderService'\nimport { useSnackbar } from '../useSnackbar'\nimport { useConfirm } from '../useConfirm'\nimport { useLoading } from '../useLoading'\nimport { createErrorHandler } from '@/utils/errorMessages'\nimport type {\n  ThreadOrderWeek,\n  CreateWeeklyOrderDTO,\n  UpdateWeeklyOrderDTO,\n  WeeklyOrderResults,\n  CalculationResult,\n  AggregatedRow,\n} from '@/types/thread'\n\nconst MESSAGES = {\n  CREATE_SUCCESS: 'Tạo tuần đặt hàng thành công',\n  UPDATE_SUCCESS: 'Cập nhật tuần đặt hàng thành công',\n  DELETE_SUCCESS: 'Xóa tuần đặt hàng thành công',\n  SAVE_RESULTS_SUCCESS: 'Lưu kết quả tính toán thành công',\n}\n\nconst getErrorMessage = createErrorHandler\\({\n  duplicate: 'Tên tuần đã tồn tại',\n  notFound: 'Không tìm thấy tuần đặt hàng',\n  validation: 'Dữ liệu không hợp lệ',\n}\\)\n\nexport function useWeeklyOrder\\(\\) {\n  // State\n  const weeks = ref<ThreadOrderWeek[]>\\([]\\)\n  const selectedWeek = ref<ThreadOrderWeek | null>\\(null\\)\n  const error = ref<string | null>\\(null\\)\n\n  // Composables\n  const snackbar = useSnackbar\\(\\)\n  const confirm = useConfirm\\(\\)\n  const loading = useLoading\\(\\)\n\n  // Computed\n  const isLoading = computed\\(\\(\\) => loading.isLoading.value\\)\n\n  const clearError = \\(\\) => {\n    error.value = null\n  }\n\n  /**\n   * Fetch all weeks from API\n   */\n  const fetchWeeks = async \\(\\): Promise<void> => {\n    clearError\\(\\)\n\n    try {\n      const data = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.getAll\\(\\)\n      }\\)\n\n      weeks.value = data\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] fetchWeeks error:', err\\)\n    }\n  }\n\n  /**\n   * Create a new weekly order\n   */\n  const createWeek = async \\(dto: CreateWeeklyOrderDTO\\): Promise<ThreadOrderWeek | null> => {\n    clearError\\(\\)\n\n    try {\n      const result = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.create\\(dto\\)\n      }\\)\n\n      snackbar.success\\(MESSAGES.CREATE_SUCCESS\\)\n      await fetchWeeks\\(\\)\n      return result\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] createWeek error:', err\\)\n      return null\n    }\n  }\n\n  /**\n   * Update an existing weekly order\n   */\n  const updateWeek = async \\(\n    id: number,\n    dto: UpdateWeeklyOrderDTO\n  \\): Promise<ThreadOrderWeek | null> => {\n    clearError\\(\\)\n\n    try {\n      const result = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.update\\(id, dto\\)\n      }\\)\n\n      // Update local state\n      weeks.value = weeks.value.map\\(\\(w\\) => \\(w.id === id ? result : w\\)\\)\n\n      if \\(selectedWeek.value?.id === id\\) {\n        selectedWeek.value = result\n      }\n\n      snackbar.success\\(MESSAGES.UPDATE_SUCCESS\\)\n      return result\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] updateWeek error:', err\\)\n      return null\n    }\n  }\n\n  /**\n   * Delete a weekly order after confirmation\n   */\n  const deleteWeek = async \\(id: number\\): Promise<boolean> => {\n    const week = weeks.value.find\\(\\(w\\) => w.id === id\\)\n    const weekName = week?.week_name || `#${id}`\n\n    const confirmed = await confirm.confirmDelete\\({\n      itemName: weekName,\n      title: 'Xác nhận xóa tuần đặt hàng',\n      message: `Bạn có chắc chắn muốn xóa \"${weekName}\"? Tất cả dữ liệu items và kết quả tính toán sẽ bị xóa.`,\n    }\\)\n\n    if \\(!confirmed\\) return false\n\n    clearError\\(\\)\n\n    try {\n      await loading.withLoading\\(async \\(\\) => {\n        await weeklyOrderService.remove\\(id\\)\n      }\\)\n\n      weeks.value = weeks.value.filter\\(\\(w\\) => w.id !== id\\)\n\n      if \\(selectedWeek.value?.id === id\\) {\n        selectedWeek.value = null\n      }\n\n      snackbar.success\\(MESSAGES.DELETE_SUCCESS\\)\n      return true\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] deleteWeek error:', err\\)\n      return false\n    }\n  }\n\n  /**\n   * Load a single week with its items\n   */\n  const loadWeek = async \\(id: number\\): Promise<ThreadOrderWeek | null> => {\n    clearError\\(\\)\n\n    try {\n      const data = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.getById\\(id\\)\n      }\\)\n\n      selectedWeek.value = data\n      return data\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] loadWeek error:', err\\)\n      return null\n    }\n  }\n\n  /**\n   * Save calculation results for a weekly order\n   */\n  const saveResults = async \\(\n    weekId: number,\n    calculationData: CalculationResult[],\n    summaryData: AggregatedRow[]\n  \\): Promise<WeeklyOrderResults | null> => {\n    clearError\\(\\)\n\n    try {\n      const result = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.saveResults\\(weekId, {\n          calculation_data: calculationData,\n          summary_data: summaryData,\n        }\\)\n      }\\)\n\n      snackbar.success\\(MESSAGES.SAVE_RESULTS_SUCCESS\\)\n      return result\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] saveResults error:', err\\)\n      return null\n    }\n  }\n\n  /**\n   * Load saved calculation results for a weekly order\n   */\n  const loadResults = async \\(weekId: number\\): Promise<WeeklyOrderResults | null> => {\n    clearError\\(\\)\n\n    try {\n      const data = await loading.withLoading\\(async \\(\\) => {\n        return await weeklyOrderService.getResults\\(weekId\\)\n      }\\)\n\n      return data\n    } catch \\(err\\) {\n      const errorMessage = getErrorMessage\\(err\\)\n      error.value = errorMessage\n      snackbar.error\\(errorMessage\\)\n      console.error\\('[useWeeklyOrder] loadResults error:', err\\)\n      return null\n    }\n  }\n\n  return {\n    // State\n    weeks,\n    selectedWeek,\n    loading: isLoading,\n    error,\n\n    // Actions\n    clearError,\n    fetchWeeks,\n    createWeek,\n    updateWeek,\n    deleteWeek,\n    loadWeek,\n    saveResults,\n    loadResults,\n  }\n}\nENDOFFILE)",
      "Bash(npx tsc:*)",
      "Bash(npx supabase:*)",
      "Bash(curl:*)",
      "Bash(psql:*)",
      "Bash(xcopy \"openspec\\\\changes\\\\weekly-thread-ordering\" \"openspec\\\\changes\\\\archive\\\\2026-02-08-weekly-thread-ordering\"\" /E /I /Q 2>&1 && rmdir /S /Q \"openspecchangesweekly-thread-ordering \")",
      "Bash(powershell -Command \"Copy-Item -Path ''openspec/changes/weekly-thread-ordering'' -Destination ''openspec/changes/archive/2026-02-08-weekly-thread-ordering'' -Recurse -Force; Remove-Item -Path ''openspec/changes/weekly-thread-ordering'' -Recurse -Force\")",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfeat\\(weekly-order\\): thêm trang đặt hàng chỉ theo tuần\n\nTính năng mới cho phép Phòng Kế Hoạch đặt hàng chỉ theo tuần:\n- Chọn nhiều mã hàng, nhiều màu, nhập số lượng riêng từng màu\n- Tính toán gộp multi-style, hiển thị chi tiết + tổng hợp\n- Lưu/tải lịch sử tuần hàng, tạo phiếu phân bổ từ kết quả\n- DB: 3 bảng mới \\(thread_order_weeks, items, results\\)\n- API: CRUD + status transitions + save/load results\n- Archive openspec changes\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "mcp__tavily__tavily-search",
      "mcp__tavily__tavily-extract",
      "Bash(npm ls:*)",
      "Bash(npm install:*)",
      "Bash(node -e:*)",
      "Bash(node:*)",
      "Bash(npm run build:*)"
    ]
  }
}
